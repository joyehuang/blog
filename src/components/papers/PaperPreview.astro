---
import type { CollectionEntry } from 'astro:content'
import { FormattedDate } from 'astro-pure/user'
import { cn } from 'astro-pure/utils'

type PaperEntry = CollectionEntry<'papers'> | CollectionEntry<'papersEn'>

interface Props {
  paper: PaperEntry
  detailed?: boolean
  class?: string
  basePath?: string
}

const { paper, detailed = false, class: className, basePath = '/papers' } = Astro.props

const {
  id,
  data: { title, description, publishDate, updatedDate, status, tags, venue, year, paperLink, draft }
} = paper

const postDate = updatedDate ?? publishDate

const statusText =
  status === 'reading' ? 'Reading' : status === 'revisit' ? 'Need Revisit' : 'Completed'

const statusClass =
  status === 'reading'
    ? 'border-amber-300/70 bg-amber-100/60 text-amber-700 dark:border-amber-700/60 dark:bg-amber-900/30 dark:text-amber-300'
    : status === 'revisit'
      ? 'border-sky-300/70 bg-sky-100/60 text-sky-700 dark:border-sky-700/60 dark:bg-sky-900/30 dark:text-sky-300'
      : 'border-emerald-300/70 bg-emerald-100/60 text-emerald-700 dark:border-emerald-700/60 dark:bg-emerald-900/30 dark:text-emerald-300'
---

<li
  class={cn(
    'group rounded-2xl border bg-background px-5 py-3 transition-colors duration-200 hover:bg-muted max-sm:px-4',
    detailed ? 'sm:py-4' : 'py-2.5',
    className
  )}
>
  <a href={`${basePath}/${id}`} class='block no-underline'>
    <div class='flex flex-wrap items-center gap-2 text-xs text-muted-foreground'>
      <FormattedDate class='font-sans' date={postDate} />
      <span class='hidden sm:inline'>•</span>
      <span>{year}</span>
      {venue && (
        <>
          <span class='hidden sm:inline'>•</span>
          <span>{venue}</span>
        </>
      )}
      <span class='hidden sm:inline'>•</span>
      <span
        class={cn(
          'rounded-full border px-2 py-0.5 font-medium',
          statusClass
        )}
      >
        {statusText}
      </span>
    </div>

    <div class='mt-1.5 flex items-start justify-between gap-3'>
      <h3 class={cn('font-medium leading-6 group-hover:text-primary', detailed ? 'text-lg' : 'text-base')}>
        {draft && <span class='text-red-500'>(Draft) </span>}
        {title}
      </h3>
      <svg
        xmlns='http://www.w3.org/2000/svg'
        width='16'
        height='16'
        viewBox='0 0 24 24'
        fill='none'
        stroke-width='2.5'
        stroke-linecap='round'
        stroke-linejoin='round'
        class='mt-1 shrink-0 stroke-muted-foreground transition-colors group-hover:stroke-primary'
      >
        <line x1='5' y1='12' x2='19' y2='12'></line>
        <polyline points='12 5 19 12 12 19'></polyline>
      </svg>
    </div>

    <p class={cn('mt-1 line-clamp-2 text-sm text-muted-foreground', detailed && 'line-clamp-3')}>
      {description}
    </p>
  </a>

  <div class='mt-2.5 flex flex-wrap items-center gap-2 text-xs'>
    <a
      href={paperLink}
      target='_blank'
      rel='noopener noreferrer'
      class='rounded-full border px-2 py-0.5 text-muted-foreground transition-colors hover:text-primary'
    >
      Original Paper ↗
    </a>
    {
      tags.map((tag) => (
        <a
          href={`${basePath}/tags/${tag}`}
          class='rounded-full border bg-muted px-2 py-0.5 text-muted-foreground transition-colors hover:text-primary'
          data-astro-prefetch
        >
          #{tag}
        </a>
      ))
    }
  </div>
</li>
